<?xml version="1.0" encoding="UTF-8"?>
<project name="DigiCom" default="make" basedir=".">
    <tstamp>
        <format property="build.date" pattern="%Y-%m-%d" />
    </tstamp>

    <property file="build.ini" />

    <target name="help">
        <echo>Use `$ phing -l` to list the available targets.</echo>
    </target>

    <target name="make-dev" description="Builds the extension release package for development testing." depends="rebuild-extension-archives">
        <echo msg="Deleting old development build." />
        <delete quiet="yes" includeemptydirs="true">
            <fileset dir="release">
                <include name="pkg_${package}_dev.zip" />
            </fileset>
        </delete>

        <echo msg="Making the development ${package} package ." />
        <zip destfile="release/pkg_${package}_dev.zip">
            <fileset dir="build">
                <include name="**" />
            </fileset>
        </zip>
    </target>

    <target name="clean" description="Cleaning build dir and preapering for package">
        <delete dir="release" quiet="yes" includeemptydirs="false" />
        <mkdir dir="release" />
    </target>

    <target name="component" description="Build Component release package for a version">

        <fileset dir="../administrator/components/com_digicom" id="com-admin">
            <include name="**" />
        </fileset>

        <fileset dir="../components/com_digicom" id="com-site">
            <include name="**" />
        </fileset>

        <copy todir="temp/com_digicom/admin" overwrite="true">
            <fileset refid="com-admin" />
        </copy>

        <copy todir="temp/com_digicom/site" overwrite="true">
            <fileset refid="com-site" />
        </copy>

        <move file="temp/com_digicom/admin/digicom.xml" todir="temp/com_digicom" />

        <zip
            destfile="release/com_digicom.zip"
            basedir="temp/com_digicom" />

        <delete dir="temp/com_digicom" quiet="yes" includeemptydirs="false" />

    </target>

    <target name="modules">

    </target>

    <target name="make" description="Builds the extension release package for a version." depends="clean, component">
        <echo msg="Making the ${package} package for version ${version}." />



        <!--<zip destfile="releases/pkg_${package}_${version}.zip">-->
            <!--<fileset dir="build">-->
                <!--<include name="**" />-->
            <!--</fileset>-->
        <!--</zip>-->
    </target>

    <target name="rebuild-extension-archives" description="Rebuilds the archive (zip) files for each extension.">
        <mkdir dir="build" />
        <mkdir dir="releases" />

        <echo msg="Cleaning build directory." />
        <delete quiet="yes" includeemptydirs="true">
            <fileset dir="*">
                <include name="build" />
            </fileset>
        </delete>

        <echo msg="Creating extension archives (zip files)." />
        <foreach param="extension" target="build-archive">
            <fileset dir="src">
                <include name="com_*" />
                <include name="mod_*" />
                <include name="plg_*" />
                <include name="tpl_*" />
            </fileset>
        </foreach>

        <copy todir="build" >
            <fileset dir="src">
                <include name="language/**" />
                <include name="pkg_${package}.xml" />
            </fileset>
        </copy>
    </target>

</project>